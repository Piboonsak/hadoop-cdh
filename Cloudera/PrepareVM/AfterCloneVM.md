After clone completed
===

## 0. Remove old ssh keys and add new knowhosts. 

`ssh -i /etc/ssh/traceon-key.pem centos@203.154.59.116`

```sh
root@piboonsak-probook:~# ssh -i /etc/ssh/traceon-key.pem centos@203.154.59.116
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
Someone could be eavesdropping on you right now (man-in-the-middle attack)!
It is also possible that a host key has just been changed.
The fingerprint for the ECDSA key sent by the remote host is
SHA256:whMi8yyNKO0FXw0aKxbL459MFsr9qwXqmrxyxnMvg3w.
Please contact your system administrator.
Add correct host key in /root/.ssh/known_hosts to get rid of this message.
Offending ECDSA key in /root/.ssh/known_hosts:20
  remove with:
  ssh-keygen -f "/root/.ssh/known_hosts" -R 203.154.59.116
ECDSA host key for 203.154.59.116 has changed and you have requested strict checking.
Host key verification failed.
```

`ssh-keygen -f "/root/.ssh/known_hosts" -R 203.154.59.116`

```sh
root@piboonsak-probook:~# ssh-keygen -f "/root/.ssh/known_hosts" -R 203.154.59.116
# Host 203.154.59.116 found: line 20
/root/.ssh/known_hosts updated.
Original contents retained as /root/.ssh/known_hosts.old
```

`ssh-keygen -f "/root/.ssh/known_hosts" -R 203.154.58.101`

```sh
root@piboonsak-probook:~# ssh-keygen -f "/root/.ssh/known_hosts" -R 203.154.58.101
# Host 203.154.58.101 found: line 19
/root/.ssh/known_hosts updated.
Original contents retained as /root/.ssh/known_hosts.old
```

# Try to ssh remote again. 

`ssh -i /etc/ssh/traceon-key.pem centos@203.154.59.116`

```sh
root@piboonsak-probook:~# ssh -i /etc/ssh/traceon-key.pem centos@203.154.59.116
The authenticity of host '203.154.59.116 (203.154.59.116)' can't be established.
ECDSA key fingerprint is SHA256:whMi8yyNKO0FXw0aKxbL459MFsr9qwXqmrxyxnMvg3w.
Are you sure you want to continue connecting (yes/no)? yes 
Warning: Permanently added '203.154.59.116' (ECDSA) to the list of known hosts.
Last login: Tue Dec 26 06:08:48 2017 from 61.19.51.178
[centos@hadoop-datanode1cdh ~]$
```

`ssh -i /etc/ssh/traceon-key.pem centos@203.154.59.116`

```sh
root@piboonsak-probook:~# ssh -i /etc/ssh/traceon-key.pem centos@203.154.58.101
The authenticity of host '203.154.58.101 (203.154.58.101)' can't be established.
ECDSA key fingerprint is SHA256:whMi8yyNKO0FXw0aKxbL459MFsr9qwXqmrxyxnMvg3w.
Are you sure you want to continue connecting (yes/no)? yes     
Warning: Permanently added '203.154.58.101' (ECDSA) to the list of known hosts.
Last login: Tue Dec 26 06:08:48 2017 from 61.19.51.178
[centos@hadoop-datanode2cdh ~]$ 
```

---

## Verify your IP address in all nodes and set to /etc/hosts file

## 1. set names in /etc/hosts


`nano /etc/hosts`

```sh
[root@hadoop-namenodecdh ~]# nano /etc/hosts
192.168.4.4     namenode1       hadoop-namenodecdh	    hadoop-namenodecdh.novalocal
192.168.4.5	    data1   		hadoop-datanode1cdh	    hadoop-datanode1cdh.novalocal
192.168.4.6	    data2	    	hadoop-datanode2cdh	    hadoop-datanode2cdh.novalocal
```

- # if hostname not change.

`sudo hostnamectl set-hostname namenode1` 

`sudo hostnamectl set-hostname data1`   - # run command on data1 host

`sudo hostnamectl set-hostname data2`   - # run command on data2 host


 - # for restart config.

`sudo /etc/init.d/network restart`  

- # for check hostname status.

`hostnamectl status`


- # for fix hostname static.

`nano /etc/sysconfig/network`

add row :
```sh
HOSTNAME=namenode1

```

- # Config file resolv

`nano /etc/resolv.conf`

add row :

```sh
#Generated by NetworkManager
search traceoncloud.com
nameserver 192.168.8.201
nameserver 203.150.213.1

```
- # Install domain tools.

`yum install sssd realmd oddjob oddjob-mkhomedir adcli samba-common samba-common-tools krb5-workstation openldap-clients policycoreutils-python -y`

join domain :

`realm join --user=cdh traceoncloud.com`

check by :

`realm list`




---

## 2. At name node, set Shared Folders to cdh. after that ran below commands


#### Enable apache2 and Mysql

*do all node include namenode1*

`systemctl start httpd.service`

`systemctl enable httpd.service`

`systemctl status httpd.service`



`systemctl start mariadb.service`

`systemctl enable mariadb.service`

`systemctl status mariadb.service`

#### Insert user root to remote anther host site.

login user root.

`mysql -u root -p`


create user root with host "%".

`CREATE USER 'root'@'%' IDENTIFIED BY 'passpass';`

grant pivilleges.

`grant all privileges on *.* to 'root'@'%' with grant option;`

test login by workbench.

---

## 3. Check apache and CDH repository file.

*try type url at brownser : http://203.154.58.100*

and

*try type url at brownser : http://203.154.58.100/cdh*

---

## 4. Create SSH Key (without passphrase) for SSH single sign-on.

`ssh-keygen`

```sh

[root@hadoop-namenodecdh ~]# ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): /root/.ssh/id_rsa
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
da:a9:a4:a7:01:b0:0c:fe:01:3f:31:59:fc:00:5a:90 root@hadoop-namenodecdh.novalocal
The key's randomart image is:
+--[ RSA 2048]----+
| .ooo.           |
| Eo oo           |
|oo +  o          |
|+oo o  .         |
|.o.+    S        |
|  ..o  o .       |
|   .. o o        |
|     +..         |
|    oo.          |
+-----------------+
[root@hadoop-namenodecdh ~]#

```

** Cat keys id_rsa.pub **

`cat ~/.ssh/id_rsa.pub`

```sh
[root@hadoop-namenodecdh ~]# cat ~/.ssh/id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCwQkFPlI5EiXiZFkA+HLmERXQ4PUQwO/Aj377AtYUyWw6F6F90T04bcqa5WzgJvRzugRdQvX1t4NvHQ12K49B+HmR4LI2b1YHFthol9YM5/FGjD3A6uppXt7c/tX1P16WZ2mDzOg1+Ash82Tm8XbNNXEyuMUasDqZjr5kPKrp5TEEehs9MXw10oB70/Qigud5sLnBP0Xl/kOL0+Ssga63oJOAnxhtvNwERWlhzi4YFMmGki3HUM+PZCFtHPtE/M7Sycb+cT2CLMB0fxJMw9H2cGXEugvpeTKvu1BOQAp2WpuOPoh8tZHnMbnUK5AAb9XdFKzfvDuzaQAFwFoPKDUul root@hadoop-namenodecdh.novalocal
```
```sh
[root@hadoop-datanode1cdh ~]# cat ~/.ssh/id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDW9AivUaucxCa6fnoEB0uloZkcGXcSxvcKMPMTpVY3gVCaeMpvFnRnDkElKpjskTBlP5GYj4golqYOWulW8b9EqB4FKESP5lTQmnN8Pbr6YHt55A7Uf/2IOezOILOLQNttd58Lh4fzqeM/Oql81hw9m6inix3mw3h6St1iolvweZHcYer6UfbU9mAGyp9dVzvZfei5nHGDWe3VZw6i8NtlgzLRl0unaS7ZUzYwqjd0LG0g+WSXEWThTEeyoCSKPaAeR6XXRSC9vo1AgMETuYVGG/jjTFGhIuZPmj/+yib/GxZSsy17oiFgandxZ5BRbyxX1jDHygSRnrnIflvuoz8B root@hadoop-datanode1cdh
```
```sh
[root@hadoop-datanode2cdh ~]# cat ~/.ssh/id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDJ09qEP8IpdJp+pFOJGyhgeLL+zp/GIIk1WgkuqXisD2tP0KNLW9sG0UzQdDsonlDwK7kO5dOAb5jtEG8PXo21vsHYOu1tKEd1YPSb6N+YWAgfGaRt4KWwitg1jNgBAwxanTMZr/vvt0IBl32SReWYr4YNRltkFMcyQkQkhhy9W8/wsHAjnkfR+i9Jh82ZqOeZ7DoPL6D0HQoCSo02w1CqPTX/WEVQGU96ip8SmCTTzHH8MnHSKYqXX4Wvc402CWWCFzWLp2T4znt0e5vSDQ1Ad3FYMy7yZyrnYatwWx1+tphYOJnw2gOnuOGHuPeoFaY3Y6wAfbqITIyoD+GYSkan root@hadoop-datanode2cdh
```

** Save keys pub to authen keys **

`cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys`

```sh
[root@hadoop-namenodecdh ~]# cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
```
```sh
[root@hadoop-datanode1cdh ~]# cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
```
```sh
[root@hadoop-datanode2cdh ~]# cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
```

** To add id_rsa.pub keys other server ex data1,data2 and do like this with anther server. **

*Tips you can save only namenode1 keys to other datanodes authorized_keys.*

`nano .ssh/authorized_keys`

```sh
[root@hadoop-namenodecdh ~]# nano .ssh/authorized_keys
```
```sh
no-port-forwarding,no-agent-forwarding,no-X11-forwarding,command="echo 'Please login as $
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCwQkFPlI5EiXiZFkA+HLmERXQ4PUQwO/Aj377AtYUyWw6F6F90$
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDW9AivUaucxCa6fnoEB0uloZkcGXcSxvcKMPMTpVY3gVCaeMpv$
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDJ09qEP8IpdJp+pFOJGyhgeLL+zp/GIIk1WgkuqXisD2tP0KNL$
```

```sh
[root@hadoop-datanode1cdh ~]# nano .ssh/authorized_keys
```
```
no-port-forwarding,no-agent-forwarding,no-X11-forwarding,command="echo 'Please $
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDW9AivUaucxCa6fnoEB0uloZkcGXcSxvcKMPMTpVY$
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCwQkFPlI5EiXiZFkA+HLmERXQ4PUQwO/Aj377AtYU$
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDJ09qEP8IpdJp+pFOJGyhgeLL+zp/GIIk1WgkuqXi$
```

```
[root@hadoop-datanode2cdh ~]# nano .ssh/authorized_keys
```
```sh
no-port-forwarding,no-agent-forwarding,no-X11-forwarding,command="echo 'Please $
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDJ09qEP8IpdJp+pFOJGyhgeLL+zp/GIIk1WgkuqXi$
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCwQkFPlI5EiXiZFkA+HLmERXQ4PUQwO/Aj377AtYU$
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDW9AivUaucxCa6fnoEB0uloZkcGXcSxvcKMPMTpVY$
```

- reloasd sshd all node server.
 
`systemctl reload sshd`

```sh
[root@namenode1 ~]# systemctl reload sshd
```

- test ssh by ssh [hostname]

`ssh data1`

```sh
[root@hadoop-namenodecdh ~]# ssh data1
Last login: Fri Dec 22 04:32:56 2017 from namenode1

```

*can do only namenode1*

*Refer Link:https://www.digitalocean.com/community/tutorials/initial-server-setup-with-centos-7#step-three-—-root-privileges*


---


## 5. Install Gnome GUI on CentOS 7 / RHEL 7 (Only on namenode) 


** wanning! If install GUI it's enable firewalld **


*http://www.itzgeek.com/how-tos/linux/centos-how-tos/install-gnome-gui-on-centos-7-rhel-7.html*


 `> yum group list`
 
 `> yum group install "GNOME Desktop" "Graphical Administration Tools"`
 
 `> ln -sf /lib/systemd/system/runlevel5.target /etc/systemd/system/default.target`
 
 `> reboot`
 
 `> init 5`


## 6. Set Firewall for allow group IP (trusted zone)

- disable Firewall

`systemctl stop firewalld`

`systemctl disable firewalld`

```sh
[root@hadoop-namenodecdh ~]# systemctl stop firewalld
[root@hadoop-namenodecdh ~]# systemctl status firewalld
● firewalld.service - firewalld - dynamic firewall daemon
   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled)
   Active: inactive (dead)
     Docs: man:firewalld(1)

ธ.ค. 21 10:04:44 hadoop-namenodecdh.novalocal systemd[1]: Starting firewa...
ธ.ค. 21 10:04:44 hadoop-namenodecdh.novalocal systemd[1]: Started firewal...
ธ.ค. 21 10:04:45 hadoop-namenodecdh.novalocal firewalld[623]: WARNING: IC...
ธ.ค. 21 10:04:45 hadoop-namenodecdh.novalocal firewalld[623]: WARNING: be...
ธ.ค. 21 10:04:45 hadoop-namenodecdh.novalocal firewalld[623]: WARNING: IC...
ธ.ค. 21 10:04:45 hadoop-namenodecdh.novalocal firewalld[623]: WARNING: fa...
ธ.ค. 21 10:04:45 hadoop-namenodecdh.novalocal firewalld[623]: WARNING: IC...
ธ.ค. 21 10:04:45 hadoop-namenodecdh.novalocal firewalld[623]: WARNING: re...
ธ.ค. 22 07:19:40 hadoop-namenodecdh.novalocal systemd[1]: Stopping firewa...
ธ.ค. 22 07:19:40 hadoop-namenodecdh.novalocal systemd[1]: Stopped firewal...
Hint: Some lines were ellipsized, use -l to show in full.

```

---

- Change centos password *at root user

```
 [root@namenode1 centos]# passwd centos
 
```


---










